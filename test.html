<!doctype html>
<style>
  body{font-family:sans-serif} 
  #runout{width:650px}
  #runout pre{margin:0;width:150px;font-size:11px;display:inline-block}
  #tiles{width:800px}
  canvas{margin:0;display:inline-block;float:left}
</style>
<body onload=runout()>
  <div id=runout>
    <h1>The numbers below should be the same on different platforms and browsers</h1>
  </div>
  <div id=tiles>
    <h1>The tiles below should be identical on different platforms and browsers</h1>
    <p>If your browser supports canvas, <button onclick=tiles()>click this</button> to generate tiles</p>
  </div>
</body>
<script src=jsrand.js></script>
<script src=jsrand-addon.js></script>
<script>

  function runout() {
    for(var i = 0; i < 28; i++) {
      _rand.seed(i);
      for(var j = 0; j < 300 * 10; j++) {
        _rand();
      }
      document.getElementById('runout').innerHTML += '<pre>' + _rand() + '</pre>';
    }
  }

  var round = 100;

  function tiles() {
    function increment(key, value) {
      if(value in key) {
        key[value]++;
        if(key[value] > maxvalue) {
          maxvalue = key[value];
        }
      } else { 
        key[value] = 1;
      }
    }

    var 
      width = 6400,
      size = Math.floor(Math.sqrt(width)),
      count = 2500,
      raster = [],
      canvas = document.getElementById('tiles').appendChild(document.createElement('canvas')),
      ctx = canvas.getContext('2d'), 
      scaled, 
      j = 0,
      maxvalue = 0,
      iter;

    for(var i = 0; i < count; i++) {
      iter = _rand(0, width);
      increment(raster, Math.floor(iter));
    }

    canvas.setAttribute('width', size);
    canvas.setAttribute('height', size);

    for(i = 0 ; i < size; i++) {
      for( j = 0; j < size; j++) {
        scaled = Math.floor(256 * raster[i * size + j] / maxvalue);
        ctx.fillStyle = "rgb(" + [scaled,scaled,scaled].join(',') + ")";
        ctx.fillRect(i,j,1,1);
      }
    }
    if(-- round > 0) {
      _rand.seed(round);
      setTimeout(tiles, 0);
    }
  }

</script>
